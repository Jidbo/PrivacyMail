import os
from django.core.exceptions import ObjectDoesNotExist

from mailfetcher.models import Mail
from identity.models import Identity, Service
from identity.util import validate_domain

targets = ["http://oxolloxo.kraftly.com", "http://testequipmentdepot.com", "https://1-day.co.nz", "https://100percentpure.com", "https://1800flowers.com", "https://1sttheworld.com", "https://2ndsworld.com.au", "https://3wishes.com", "https://4wdsupacentre.com.au", "https://6pm.com", "https://8seasons.com", "https://aafnation.com", "https://abdulwahed.com", "https://adameve.com", "https://adamspolishes.com", "https://additionelle.com", "https://adidas.co.uk", "https://adidas.com.au", "https://adidas.com.my", "https://adidas.com.ph", "https://adidas.com.sg", "https://adidas.fi", "https://adogadgets.com", "https://adorama.com", "https://adoreme.com", "https://adriannapapell.com", "https://adultproductsindia.com", "https://advanti.com", "https://affordableblinds.com", "https://afremov.com", "https://agacistore.com", "https://agjeans.com", "https://airfiltersdelivered.com", "https://airportappliance.com", "https://airydress.com", "https://alaindupetit.com", "https://albeebaby.com", "https://alkaramstudio.com", "https://allonlinestore.in", "https://alltricks.com", "https://alofthobbies.com", "https://alpacadirect.com", "https://alpinetrek.co.uk", "https://amazon.co.uk", "https://ambitwheels.com", "https://americangirl.com", "https://amerisleep.com", "https://amleo.com", "https://ammunitiondepot.com", "https://amourvert.com", "https://anarchiststate.com", "https://anglingdirect.co.uk", "https://annthegran.com", "https://antlionaudio.com", "https://anuradhaartjewellery.com", "https://apeainthepod.com", "https://apexgunparts.com", "https://apexhunting.com.au", "https://apmex.com", "https://appliancefactoryparts.com", "https://aptdeco.com", "https://aquacave.com", "https://ar15discounts.com", "https://artfire.com", "https://artgallery.co.uk", "https://artsper.com", "https://ashleystewart.com", "https://aspinaloflondon.com", "https://atlantacutlery.com", "https://atlanticcigar.com", "https://attitudetoday.com", "https://audio46.com", "https://australianplantsonline.com.au", "https://authenticwatches.com", "https://autocraze.com.au", "https://autogeek.net", "https://avasflowers.net", "https://aveda.com", "https://badassglass.com", "https://badgleymischka.com", "https://baileynelson.com.au", "https://bandier.com", "https://banzaihobby.com", "https://bargainhardware.co.uk", "https://barkersonline.co.nz", "https://bathstore.com", "https://batteryjunction.com", "https://battlemerchant.com", "https://bbbsports.com", "https://bbwheelsonline.com", "https://bcbg.com", "https://bdshop.com", "https://beachcamera.com", "https://bearmattress.com", "https://beautifulhalo.com", "https://beautyexpert.com", "https://beautypie.com", "https://beautytap.com", "https://beckettsimonon.com", "https://beddinginn.com", "https://beds.co.uk", "https://beetstech.com", "https://begears.com", "https://belk.com", "https://bellalike.com", "https://bellamihair.com", "https://bergfreunde.eu", "https://berrylook.com", "https://bestcigarprices.com", "https://bestheating.com", "https://bestlaminate.com", "https://bestpartstore.co.uk", "https://bestsellerclothing.ca", "https://bestzone.kraftly.com", "https://bettereyewear.com", "https://bettystoybox.com", "https://beyondretro.com", "https://bhphotovideo.com", "https://bidforx.com", "https://biltwellinc.com", "https://bioclarity.com", "https://biofinest.com", "https://blackboxmycar.com", "https://blade-city.com", "https://blair.com", "https://blakelyclothing.com", "https://blenderseyewear.com", "https://blindsdirect.co.uk", "https://blindster.com", "https://blippo.com", "https://blipshift.com", "https://blnts.com", "https://blowoutcards.com", "https://bluenile.com", "https://bluesky.com", "https://bobswatches.com", "https://bodybuilding.com", "https://bokksu.com", "https://bonanzamarket.co.uk", "https://bonescoffee.com", "https://bonnyread.com.tw", "https://boohoo.com", "https://boohooman.com", "https://bookmartialarts.com", "https://bosley.com", "https://bowlingball.com", "https://brandalley.co.uk", "https://brandhousedirect.com.au", "https://brandsego.com", "https://brandsforless.ae", "https://brathwait.com", "https://bravoconcealment.com", "https://brightechshop.com", "https://brighterblooms.com", "https://brilliantbikes.co.uk", "https://briogeohair.com", "https://brompton.com", "https://brooklinen.com", "https://brooktaverner.co.uk", "https://brosa.com.au", "https://brother.ca", "https://brownsshoes.com", "https://brylanehome.com", "https://buckwholesale.com", "https://budexpressnow.ca", "https://budgetgolf.com", "https://bugasalt.com", "https://bulbhead.com", "https://bulkreefsupply.com", "https://bumpboxes.com", "https://burkesoutlet.com", "https://burton.co.uk", "https://buy.mazumamobile.com", "https://buycostumes.com", "https://buydig.com", "https://buymobile.com.au", "https://buymyweedonline.ca", "https://buytshirtsonline.co.uk", "https://cablestogo.com", "https://cajungunworks.com", "https://calvinklein.ca", "https://cambridgesatchel.com", "https://camilla.com", "https://campaignliving.com", "https://campfireaudio.com", "https://campsaver.com", "https://canadaweeddispensary.ca", "https://candyfavorites.com", "https://candywarehouse.com", "https://canna-pet.com", "https://cannabismo.ca", "https://canvaschamp.com", "https://capbeauty.com", "https://carandtruckremotes.com", "https://caraudiocentre.co.uk", "https://carmodsaustralia.com.au", "https://carpartsdiscount.com", "https://carpetright.co.uk", "https://cases.com", "https://casettetomp3.com", "https://castlery.com", "https://catch.com.au", "https://cbazaar.com", "https://cbdfx.com", "https://cellphonecases.com", "https://cellularoutfitter.com", "https://cemarose.com", "https://centralvapors.com", "https://cgelves.com", "https://chainedandable.com", "https://chainreactioncycles.com", "https://championshipproductions.com", "https://charleskeith.com", "https://cheapundies.com", "https://cheryls.com", "https://chicagomusicexchange.com", "https://chicdelta.com", "https://chicsoul.com", "https://chicwish.com", "https://chinagadgetsreviews.com", "https://choicefurnituresuperstore.co.uk", "https://cityfurniture.com", "https://citysightsny.com", "https://claires.com", "https://clatterans.com", "https://claudioluglishirts.com", "https://cleanlinesurf.com", "https://clovia.com", "https://cobone.com", "https://cocooncenter.co.uk", "https://cokodive.com", "https://colorit.com", "https://colorsbridesmaid.com", "https://columbia.com", "https://columbiasportswear.co.uk", "https://commonpanda.com", "https://condorcycles.com", "https://coolhockey.com", "https://coolwinks.com", "https://corvettemods.com", "https://cotopaxi.com", "https://countryattire.com", "https://countycomm.com", "https://couturecandy.com", "https://coverscart.com", "https://crankbrothers.com", "https://crazysales.com.au", "https://criquetshirts.com", "https://crossrope.com", "https://crownforeverla.com", "https://cspcart.com", "https://cuddleclones.com", "https://currenstore.com", "https://cuttingboard.com", "https://cyclingexpress.com", "https://czcustom.com", "https://czechbeadsexclusive.com", "https://d-fantix.com", "https://dailygifty.com", "https://dailylook.com", "https://dailysale.com", "https://dankstop.com", "https://daraz.com.np", "https://daraz.pk", "https://darngoodyarn.com", "https://davidsbridal.com", "https://daziusa.com", "https://dazzlepro.com", "https://decalgirl.com", "https://dekanta.com", "https://desirewear.co", "https://dessy.com", "https://destinationmaternity.com", "https://devshoppe.com", "https://diabolikdvd.com", "https://diamondcbd.com", "https://dicksmith.co.nz", "https://dickssportinggoods.com", "https://diffeyewear.com", "https://digitalsupplyusa.com", "https://dillards.com", "https://dipyourcar.com", "https://discountbandit.com", "https://discountcontactlenses.com", "https://discountsupplements.ie", "https://disctech.com", "https://divvyupsocks.com", "https://diyelectricskateboard.com", "https://diyelectronics.co.za", "https://dockers.com", "https://doduae.com", "https://doreenbeads.com", "https://dormco.com", "https://dormify.com", "https://dreamcloudsleep.com", "https://dreams.co.uk", "https://dressbarn.com", "https://dresscodeclothing.com", "https://dresslikea.com", "https://dresslily.com", "https://droneworld.co.za", "https://droom.in", "https://dudegadgets.com", "https://duluthpack.com", "https://dunelondon.com", "https://dynastynerds.com", "https://dyson.co.uk", "https://dysoncanada.ca", "https://eastdane.com", "https://easysmx.com", "https://ebay.ca", "https://ebay.co.uk", "https://ebay.ie", "https://ebay.ph", "https://ecanopy.com", "https://edgars.co.za", "https://edisac.com", "https://eightvape.com", "https://ekwb.com", "https://electricfireplacesdepot.com", "https://electrictobacconist.co.uk", "https://electrictobacconist.com", "https://electronicexpress.com", "https://elevacity.com", "https://elimarpigeons.com", "https://ellis-brigham.com", "https://eluktronics.com", "https://emerica.com", "https://emmacloth.com", "https://empowerlaptop.com", "https://en-saudi.ounass.com", "https://eonsmoke.com", "https://epicsports.com", "https://ericdress.com", "https://espares.co.uk", "https://essentialphoto.co.uk", "https://eternityrose.com.au", "https://etnies.com", "https://everything5pounds.com", "https://everzon.com", "https://evine.com", "https://exposedskincare.com", "https://eyecandys.com", "https://eyedictive.com", "https://eyewearbrands.com", "https://ezibuy.com", "https://fabletics.ca", "https://fabriclore.com", "https://fabrics-store.com", "https://fahrneyspens.com", "https://faithful-to-nature.co.za", "https://famous-smoke.com", "https://fanatics.com", "https://fancytigercrafts.com", "https://fans-made.com", "https://faradayscienceshop.com", "https://farmers.co.nz", "https://fashionandyou.com", "https://fashionmia.com", "https://fashionnova.com", "https://fashionphile.com", "https://fashionworld.co.uk", "https://fastrack.in", "https://fatbuddhastore.com", "https://fathersonsclothing.com", "https://filtersfast.com", "https://finditparts.com", "https://finefoodspecialist.co.uk", "https://first4magnets.com", "https://fitstarapparel.com", "https://fivebelow.com", "https://fivestoryny.com", "https://fjt-shop.store", "https://flatpyramid.com", "https://flattummyco.com", "https://fleetfeet.com", "https://flipkart.com", "https://floraandfauna.com.au", "https://floryday.com", "https://flowerbeauty.com", "https://flowershopping.com", "https://fluevog.com", "https://fnp.com", "https://footjoy.com", "https://footlocker.com.au", "https://forever21.com", "https://forplaycatalog.com", "https://forwardrevive.com", "https://forzieri.com", "https://fotodioxpro.com", "https://foxstark.com", "https://fragrancenet.com", "https://freeshipdeals.com", "https://freestylextreme.com", "https://ftd.com", "https://fugoo.com", "https://fullbeauty.com", "https://fullcompass.com", "https://fullyfilmy.in", "https://furniture123.co.uk", "https://furnod.com", "https://fuzz.online", "https://fwrd.com", "https://fwreshinc.com", "https://g-ro.com", "https://gadgetfix.com", "https://gardner-white.com", "https://garmentquarter.com", "https://garrettwade.com", "https://gartnerstudios.com", "https://gasbike.net", "https://gearbest.com", "https://geekbuying.com", "https://gemnation.com", "https://geo-def.com", "https://gerbergear.com", "https://gettoppik.com", "https://gg3be0.com", "https://ghibli.store", "https://giftsforyounow.com", "https://glasses.com", "https://glassesdirect.co.uk", "https://glassesusa.com", "https://globalsugarart.com", "https://glockstore.com", "https://gogroopie.com", "https://golfavenue.com", "https://golftown.com", "https://gopowear.com", "https://gosawa.com", "https://grahamandgreen.co.uk", "https://grandwesternsteaks.com", "https://grasscity.com", "https://greathealthworks.com", "https://greenbelly.co", "https://greenfingers.com", "https://groupon.com", "https://groupvertical.com", "https://grove.co", "https://gshock.com", "https://gunsmidwest.com", "https://haband.com", "https://hackettequipment.com", "https://haglofs.com", "https://hairfinity.com", "https://hairmax.com", "https://halfords.com", "https://hamee-india.com", "https://hand2mind.com", "https://harney.com", "https://harveynorman.com.sg", "https://harveynorman.ie", "https://hatsandcaps.co.uk", "https://hautelook.com", "https://hayacupuncture.co.uk", "https://headphonezone.in", "https://healthkart.com", "https://healthrangerstore.com", "https://healthyhempoil.com", "https://heartlandamerica.com", "https://heatandplumb.com", "https://heatedsneaks.com", "https://helmutlang.com", "https://hermo.my", "https://herringshoes.co.uk", "https://herschel.ca", "https://herschel.com", "https://herschel.eu", "https://herschelsupplyco.co.uk", "https://hhokit.ie", "https://hijup.com", "https://hiphopbling.com", "https://hipvan.com", "https://hobobags.com", "https://hockeygiant.com", "https://hollandandbarrett.com", "https://hollandandbarrett.ie", "https://homage.com", "https://homesickcandles.com", "https://homewetbar.com", "https://honeybum.com", "https://hopscotch.in", "https://hotsauce.com", "https://hotter.com", "https://houseoffraser.co.uk", "https://houzz.com", "https://hsjohnson.com", "https://humblejuiceco.com", "https://hydrobuilder.com", "https://hygoshop.com", "https://hyperli.com", "https://icebreaker.com", "https://icing.com", "https://iedm.com", "https://iheartcats.com", "https://iheartraves.com", "https://ikigaisoul.com", "https://ikrush.com", "https://image.sportsmansguide.com", "https://impressionsvanity.com", "https://indiarush.com", "https://indiemerch.com", "https://inlineskates.com", "https://inspireuplift.com", "https://instwatch.com", "https://inthestyle.com", "https://intotheam.com", "https://invictastores.com", "https://ironandresin.com", "https://isawitfirst.com", "https://jaanuu.com", "https://jabong.com", "https://jacamo.co.uk", "https://jachsny.com", "https://jackerwin.com", "https://jaeger.co.uk", "https://jamesallen.com", "https://jamtangan.com", "https://japancodesupply.com", "https://japanny.com", "https://jayjays.com.au", "https://jbox.com", "https://jbrandjeans.com", "https://jcpenney.com", "https://jcrew.com", "https://jd-sports.com.au", "https://jenshansen.com", "https://jetonline.co.za", "https://jetpens.com", "https://jeulia.com", "https://jjmehta.com", "https://jjshouse.co.uk", "https://jjshouse.com", "https://jjshouse.com.au", "https://joesjeans.com", "https://josbank.com", "https://jossandmain.com", "https://jouercosmetics.com", "https://joybird.com", "https://joybuy.com", "https://jpressonline.com", "https://jrcigars.com", "https://jsaccessories.co.uk", "https://jskis.com", "https://jsumo.com", "https://julbie.com", "https://junebridals.com", "https://justfab.co.uk", "https://justfab.com", "https://justfabrics.co.uk", "https://justfashionnow.com", "https://justformen.com", "https://justhype.co.uk", "https://kaaum.com", "https://kamikoto.com", "https://kappa-usa.com", "https://katyperrycollections.com", "https://kaufmann-mercantile.com", "https://kawaiination.com", "https://kbdfans.cn", "https://kendrascott.com", "https://keylessentryremotefob.com", "https://khazanay.pk", "https://kiiroo.com", "https://kingpower.com", "https://kingsizedirect.com", "https://kismetcollections.com", "https://klaiyihair.com", "https://knockaround.com", "https://koala.com", "https://kohls.com", "https://kooding.com", "https://kratomcrazy.com", "https://krystalkraftartstudio.kraftly.com", "https://ktmtwins.com", "https://kurufootwear.com", "https://kuwait.ounass.com", "https://ladida.com", "https://laithwaites.co.uk", "https://lancasterarchery.com", "https://landofcoder.com", "https://laptopchargerfactory.com", "https://laptopoutlet.co.uk", "https://laptopsdirect.co.uk", "https://largodrive.com", "https://larizia.com", "https://lashkaraa.com", "https://lastcall.com", "https://latestone.com", "https://laylasleep.com", "https://lazada.com.ph", "https://lazada.sg", "https://leatherhidestore.com", "https://lectory.com.au", "https://leesa.com", "https://lensrentals.com", "https://leprix.com", "https://levelninesports.com", "https://levenger.com", "https://levi.com", "https://levi.in", "https://levinfurniture.com", "https://lifestylebyps.com", "https://lifestylesports.com", "https://lightbulbs-direct.com", "https://lighterusa.com", "https://lighting-direct.co.uk", "https://lightinthebox.com", "https://liionwholesale.com", "https://liligal.com", "https://lilyvanity.com", "https://lindinger.at", "https://linenchest.com", "https://linkshe.com", "https://linksoflondon.com", "https://linksoul.com", "https://littledesire.com", "https://littlewoodsireland.ie", "https://liveaquaria.com", "https://livefashionable.com", "https://liveinfinitely.com", "https://livelovepolish.com", "https://lizardjuice.com", "https://loaf.com", "https://lockpicks.com", "https://loefflerrandall.com", "https://logoup.com", "https://lookfantastic.com", "https://louiesupply.com", "https://loungefly.com", "https://lovecrochet.com", "https://loveknitting.com", "https://luckytacklebox.com", "https://lunya.co", "https://lupsona.com", "https://maccosmetics.co.uk", "https://mackage.com", "https://mackspw.com", "https://macmall.com", "https://macsautoparts.com", "https://madamebridal.com", "https://madebyhemp.com", "https://madison-reed.com", "https://magicmadhouse.co.uk", "https://magidglove.com", "https://makegoodies.com", "https://makershed.com", "https://mandmdirect.com", "https://mandmdirect.ie", "https://mandp.co.uk", "https://manfrotto.co.uk", "https://manscaped.com", "https://marcytilton.com", "https://marideal.mu", "https://marineshop.net", "https://markselectrical.co.uk", "https://marleylilly.com", "https://mattblatt.com.au", "https://mattressfirm.com", "https://maxguitarstore.com", "https://mejuri.com", "https://menkind.co.uk", "https://merchoid.com", "https://messicks.com", "https://micromark.com", "https://mightydeals.com", "https://mikescomputershop.com", "https://milkandeggs.com", "https://miniinthebox.com", "https://minted.com", "https://mirraw.com", "https://missyempire.com", "https://mkhstore.kraftly.com", "https://mlsstore.com", "https://mobiledefenders.com", "https://mobilefun.co.uk", "https://mobilesentrix.com", "https://modafinilstar.com", "https://modcloth.com", "https://modlily.com", "https://monkstars.com", "https://moodfabrics.com", "https://moparpartsoverstock.com", "https://morebeer.com", "https://mossberg.com", "https://motionrc.com", "https://motoin.de", "https://motoloot.com", "https://motorcyclecloseouts.com", "https://mottandbow.com", "https://mountaingear.com", "https://mpb.com", "https://mrdiy.com.my", "https://mremountain.com", "https://mrosy.com", "https://mtdparts.com", "https://mud-pie.com", "https://murrayscheese.com", "https://museumreplicas.com", "https://musiciansfriend.com", "https://mxstore.com.au", "https://myantitheftbackpack.com", "https://mybobs.com", "https://mydeal.com.au", "https://mydigitaldiscount.com", "https://mydreamstore.in", "https://myfave.com", "https://mylola.com", "https://mymemory.co.uk", "https://myphotosocks.com", "https://mypillow.com", "https://mytrendyphone.co.uk", "https://mytrendyphone.eu", "https://mytruwood.com", "https://na-kd.com", "https://namenecklace.com", "https://nastygal.com", "https://naturallife.com", "https://naturehills.com", "https://naughtyboy.com.au", "https://nbeads.com", "https://necessaryclothing.com", "https://nectarsleep.com", "https://needleandthread.com", "https://nest.co.uk", "https://net32.com", "https://netmeds.com", "https://new.minimania.com", "https://newbalance.co.uk", "https://newfrog.com", "https://newrepublicman.com", "https://next.co.uk", "https://next.com.au", "https://next.ie", "https://nextdealshop.com", "https://nflshop.com", "https://nfm.com", "https://nhlshop.ca", "https://nichecanvas.com", "https://nierle.com", "https://ninelineapparel.com", "https://noahscave.com", "https://nohowstyle.com", "https://nordictrack.com", "https://nordstromrack.com", "https://normanrecords.com", "https://northridge4x4.com", "https://novica.com", "https://nrastore.com", "https://nutrabay.com", "https://nyxcosmetics.com", "https://nzgameshop.com", "https://oasis-stores.com", "https://obrienswine.ie", "https://officechairatwork.com", "https://officesupply.com", "https://ojcommerce.com", "https://okayamadenim.com", "https://oldies.com", "https://oman.ounass.com", "https://onceit.co.nz", "https://onceuponatee.net", "https://onekingslane.com", "https://onepiece.com", "https://onnit.com", "https://opticsplanet.com", "https://organicaromas.com", "https://organizeit.com", "https://originalpenguin.com", "https://orthofeet.com", "https://othertees.com", "https://ottasilver.com", "https://ottega.com", "https://ounass.ae", "https://outdoorvancouver.ca", "https://outerknown.com", "https://overstock.ca", "https://overstock.com", "https://ownaj.com", "https://ozgameshop.com", "https://pacificcoast.com", "https://pacsun.com", "https://pages.daraz.lk", "https://pandahall.com", "https://papayaclothing.com", "https://paperwishes.com", "https://paragonsports.com", "https://parentgiving.com", "https://parnis.org", "https://parts-people.com", "https://partstown.com", "https://paulayoung.com", "https://pavers.co.uk", "https://pc-canada.com", "https://pclinkshop.co.za", "https://pcworld.co.uk", "https://pedparts.co.uk", "https://pelacase.com", "https://penningtons.com", "https://peopletree.co.uk", "https://perigold.com", "https://perryellis.com", "https://personalizationmall.com", "https://petcube.com", "https://petermillar.com", "https://petplus.com", "https://petshop.co.uk", "https://phaserfpv.com.au", "https://pickleballcentral.com", "https://pictureline.com", "https://pigsback.com", "https://pitbullaudio.com", "https://pitstopusa.com", "https://pixajoy.com.my", "https://pixiemarket.com", "https://planetcyclery.com", "https://planetofthevapes.com", "https://planetx.co.uk", "https://platt.com", "https://plumbnation.co.uk", "https://plumbworld.co.uk", "https://plumprettysugar.com", "https://pmtonline.co.uk", "https://polyvinylrecords.com", "https://pomelofashion.com", "https://pooldawg.com", "https://poolsupplies.com", "https://popjulia.com", "https://popreal.com", "https://popsockets.com", "https://porndeals.com", "https://portmans.com.au", "https://postergully.com", "https://pouted.com", "https://powder7.com", "https://predatornutrition.com", "https://preppergunshop.com", "https://prettygreen.com", "https://prettylittlething.com.au", "https://prettylittlething.us", "https://prettysimplemusic.com", "https://primary.com", "https://primrose.co.uk", "https://printfads.com", "https://proav.co.uk", "https://procook.co.uk", "https://proenzaschouler.com", "https://proflowers.com", "https://proform.com", "https://projectorpeople.com", "https://projectyourself.com", "https://propshop24.com", "https://prospeedracing.com.au", "https://pssl.com", "https://publicdesire.com", "https://puffy.com", "https://purebulk.com", "https://purekana.com", "https://purple.com", "https://purpletrail.com", "https://qmuniforms.com", "https://quadlockcase.com", "https://quiltedjoy.com", "https://radioshack.com", "https://raenwear.com", "https://rageon.com", "https://rainbowshops.com", "https://rainierarms.com", "https://raleighusa.com", "https://rayashop.com", "https://rcmoment.com", "https://readers.com", "https://readymaderc.com", "https://realtruck.com", "https://rebeccataylor.com", "https://rebelcircus.com", "https://rebelliousfashion.co.uk", "https://rednecknationstrong.com", "https://reebok.ca", "https://reebok.com", "https://reima.com", "https://relationsracewheels.com", "https://rentrip.in", "https://replacements.com", "https://reptilecentre.com", "https://retro-stage.com", "https://ribblecycles.co.uk", "https://riccardiboston.com", "https://riotsociety.com", "https://ripndipclothing.com", "https://rkguns.com", "https://roadrunnersports.com", "https://roamans.com", "https://robinsons.com.sg", "https://rockabilia.com", "https://rockport.com", "https://rockymountainoils.com", "https://rogansshoes.com", "https://rollersnakes.co.uk", "https://romadesignerjewelry.com", "https://rondomusic.com", "https://roolee.com", "https://rosenbergshoes.com.au", "https://rosewe.com", "https://ross-simons.com", "https://rosymerry.com", "https://rotita.com", "https://roveconcepts.com", "https://rpgstash.com", "https://rugs.com", "https://runningboardwarehouse.com", "https://rustico.com", "https://rw-co.com", "https://saa.co.uk", "https://saba.com.au", "https://saboskirt.com", "https://safishing.com", "https://sallybeauty.co.uk", "https://salon-services.com", "https://saltlife.com", "https://sammydress.com", "https://samsung.com", "https://sandcloud.com", "https://sanitarya.com", "https://sastimedicine.com", "https://sated.com", "https://savagex.com", "https://savethebeesproject.com", "https://scandinavianoutdoor.com", "https://schuh.co.uk", "https://schuh.eu", "https://schuh.ie", "https://schuylerarmsco.com", "https://scienceinsport.com", "https://screenguards.co.in", "https://secretlab.eu", "https://secretsales.com", "https://secure.mdg.com", "https://seekdiscomfort.com", "https://selectblinds.com", "https://sendflowers.com", "https://sensibo.com", "https://sexyrealsexdolls.com", "https://sgs-engineering.com", "https://shapermint.com", "https://sharperimage.com", "https://shavershop.com.au", "https://sheamoisture.com", "https://sheeel.com", "https://shirtspace.com", "https://shoeaholics.com", "https://shoedazzle.com", "https://shoespie.com", "https://shop-gocase.com", "https://shop.adidas.ae", "https://shop.adidas.co.za", "https://shop.adidas.com.kw", "https://shop.adidas.com.sa", "https://shop.americantourister.com", "https://shop.atperrys.com", "https://shop.buyautoparts.com", "https://shop.envirofone.com", "https://shop.iravin.com", "https://shop.lalabu.com", "https://shop.mochithings.com", "https://shop.ogadget.com", "https://shop.ozobot.com", "https://shop.ugmonk.com", "https://shop.vstarcam.com", "https://shop.wigsbuy.com", "https://shop49ers.com", "https://shopcaseyneistat.com", "https://shopdixi.com", "https://shopdoen.com", "https://shopgoodtimes.co", "https://shopilovejewelry.com", "https://shopimpressions.com", "https://shoplostfound.com", "https://shopolis.com", "https://shoporangetheory.com", "https://shopperschoice.com", "https://shoppersstop.com", "https://shoppingsquare.com.au", "https://shopplanetblue.com", "https://shoppriceless.com", "https://shopspring.com", "https://shopthemint.com", "https://shopurbansociety.com", "https://shopus.furbo.com", "https://shopvida.com", "https://sierralivingconcepts.com", "https://silencershop.com", "https://simplycarbonfiber.com", "https://simplyswim.com", "https://sivanaspirit.com", "https://skatedeluxe.com", "https://skatehut.co.uk", "https://slickieslaces.com", "https://smartbuyglasses.co.in", "https://smashingcommerce.com", "https://smiggle.com.au", "https://smokecartel.com", "https://snowys.com.au", "https://soccerlord.se", "https://soffe.com", "https://softballfans.com", "https://soillholds.com", "https://solebicycles.com", "https://solidandstriped.com", "https://solomotoparts.com", "https://sonicelectronix.com", "https://soufeel.com", "https://sourcevapes.com", "https://southerntide.com", "https://spanx.com", "https://spartanarmorsystems.com", "https://spartoo.co.uk", "https://speedcubeshop.com", "https://speedousa.com", "https://spencersonline.com", "https://spiritwear.com", "https://sportscraft.com.au", "https://sportsmanguncentre.co.uk", "https://sportsmansoutdoorsuperstore.com", "https://spotmodel.com", "https://spparos.com", "https://sprezzabox.com", "https://sprinklerwarehouse.com", "https://squattypotty.com", "https://stanley-pmi.com", "https://starbuy.com.au", "https://staud.clothing", "https://stayclassy.in", "https://stealthangelsurvival.com", "https://stefaniamode.com", "https://steinhafels.com", "https://stetson.eu", "https://stevespanglerscience.com", "https://stio.com", "https://store.geeksaresexy.net", "https://store.hp.com", "https://store.kimberamerica.com", "https://store.kix-files.com", "https://store.ringtoperfection.com", "https://store.simplymac.com", "https://store.yitechnology.com", "https://strawberrynet.com", "https://stuartweitzman.com", "https://stylepit.com", "https://styletread.com.au", "https://stylewe.com", "https://sugarandcotton.com", "https://sunberhair.com", "https://sunglass.la", "https://sunglasses-shop.co.uk", "https://superdrug.com", "https://superfi.co.uk", "https://superraregames.com", "https://supply.com", "https://surfstitch.com", "https://suzyshier.com", "https://swagtron.com", "https://swamp.net.au", "https://swap.com", "https://swelluk.com", "https://swfa.com", "https://swimsuitsforall.com", "https://swimwearworld.com", "https://tarptent.com", "https://tartecosmetics.com", "https://teachersdiscovery.com", "https://techforless.com", "https://teechip.com", "https://tekton.com", "https://templeandwebster.com.au", "https://temptationgifts.com", "https://tennis-point.com", "https://tennisnuts.com", "https://tentworld.com.au", "https://tessuti.co.uk", "https://teva.co.uk", "https://textualtees.com", "https://thbaker.co.uk", "https://the-house.com", "https://thebodyshop.co.id", "https://thebodyshop.com.my", "https://thebookshoponline.com", "https://thecakedecoratingcompany.co.uk", "https://thechivery.com", "https://thedablab.com", "https://thedollarejuiceclub.com", "https://thegymking.com", "https://thehardwarehut.com", "https://theinsolestore.com", "https://thejapaneseshop.co.uk", "https://thejewelhut.co.uk", "https://theluxurycloset.com", "https://theproteinworks.com", "https://therealreal.com", "https://thertastore.com", "https://thesaucela.com", "https://theshoemart.com", "https://thevectorlab.com", "https://thewodlife.com.au", "https://thgrow.com", "https://thinkempire.com", "https://thredup.com", "https://thursdayboots.com", "https://ticwatches.co.uk", "https://tilebar.com", "https://timebyme.com", "https://timepiece.com", "https://titan.fitness", "https://tjc.co.uk", "https://tjori.com", "https://tkmaxx.com", "https://tmart.com", "https://tntonlife.com", "https://todaysbuzz.in", "https://tokersupply.com", "https://tomorrowsleep.com", "https://toolbarn.com", "https://toolstop.co.uk", "https://topcoat.store", "https://topodesigns.com", "https://torrid.com", "https://toryburch.co.uk", "https://toryburch.eu", "https://totemokawaiishop.com", "https://touratech-usa.com", "https://toysonfire.ca", "https://traxnyc.com", "https://treds.co.uk", "https://treehut.co", "https://trendia.in", "https://trendsgal.com", "https://trendyparadize.com", "https://trespass.com", "https://truereligion.com", "https://ttdeye.com", "https://turntablelab.com", "https://twistedthrottle.com", "https://u90soccer.com", "https://uberkinky.co.uk", "https://ugaoo.com", "https://uk.gamesplanet.com", "https://uk.scitecnutrition.com", "https://ukmeds.co.uk", "https://uksoccershop.com", "https://ullapopken.com", "https://ultimategametable.com", "https://ultimatepatio.com", "https://unionmadegoods.com", "https://uniqlo.com", "https://universitycoop.com", "https://unmannedtechshop.co.uk", "https://urban-planet.com", "https://urbandecay.co.uk", "https://urbandecay.com", "https://urbanedcsupply.com", "https://urbanoutfitters.com", "https://us.buywow.com", "https://us.fashionbunker.com", "https://us.fatface.com", "https://us.geekstore.com", "https://us.missselfridge.com", "https://us.pandora.net", "https://us.rains.com", "https://us.shop.runningroom.com", "https://us.topman.com", "https://usa.tommy.com", "https://vanness1938.com", "https://vapejuicedepot.com", "https://vapevandal.com", "https://vaporbeast.com", "https://vaporizerchief.com", "https://vapoureyes.co.nz", "https://vapoureyes.com.au", "https://vertagear.com", "https://very.co.uk", "https://veryvoga.com", "https://vickypick.com", "https://victorianplumbing.co.uk", "https://victoriaplum.com", "https://victoriassecret.com", "https://videogameperfection.com", "https://videolinks.com", "https://vincecamuto.com", "https://vinegarsyndrome.com", "https://vinpok.com", "https://viralstyle.com", "https://vistavapors.com", "https://vitalityextracts.com", "https://vitaminexpress.org", "https://vitatra.com", "https://vodafone.co.nz", "https://voe21.com", "https://voga.com", "https://voylla.com", "https://walmart.com", "https://waterliberty.com", "https://wayfair.com", "https://weapon762.com", "https://wellindal.com", "https://westbrookcycles.co.uk", "https://wethepeopleholsters.com", "https://wetseal.com", "https://whitecloudelectroniccigarettes.com", "https://wholesalesuiteplugin.com", "https://wickedcushions.com", "https://wiggle.co.uk", "https://wildflowercases.com", "https://wildsecrets.com.au", "https://wildwoodguitars.com", "https://williams-sonoma.com", "https://wilsonamplifiers.com", "https://wineaccess.com", "https://winebarrel.com", "https://wineenthusiast.com", "https://wineinsiders.com", "https://wisefoodstorage.com", "https://wishtrend.com", "https://wolfandbadger.com", "https://wolfandshepherd.com", "https://woodenstreet.com", "https://woodhouseclothing.com", "https://woolrich.com", "https://workhey.com", "https://workingperson.com", "https://worldofbooks.com", "https://wowcher.co.uk", "https://wowgoboard.com", "https://wristband.com", "https://wsjwine.com", "https://wwbw.com", "https://wwgoa.com", "https://xenonhids.com", "https://yaantra.com", "https://yandy.com", "https://yarn.com", "https://yellowoctopus.com.au", "https://yeskicks.cn", "https://yesstyle.com", "https://yeswevibe.com", "https://ylcamera.com.my", "https://ylighting.com", "https://yogisurprise.com", "https://yourwdwstore.net", "https://yumo.ca", "https://zaful.com", "https://zando.co.za", "https://zasttra.com", "https://zerolemon.com", "https://zodeys.com", "https://zookr.in", "https://zoolaa.com", "https://zotezo.com", "https://zox.la", "https://zzounds.com"]
# targets = ["atperrys.com", "wineinsiders.com", "centralvapors.com", "countycomm.com", "beautypie.com", "mirraw.com", "forzieri.com", "nordstromrack.com", "inlineskates.com", "tartecosmetics.com", "imaginaryfoundation.com", "aafnation.com", "lastcall.com", "cbdfx.com", "iheartcats.com", "luckytacklebox.com", "netzpolitik.org", "magicmadhouse.co.uk", "savagex.de", "tkmaxx.com", "rustico.com", "proflowers.com", "net32.com", "simplyswim.com", "1-day.co.nz", "squattypotty.com", "kiiroo.com", "washingtonexaminer.com", "flattummyco.com", "overstock.ca", "surfstitch.com", "repubblica.it", "faz.de", "mattressfirm.com", "rcmoment.com", "6pm.com", "fragrancenet.com", "roolee.com", "workingperson.com", "shopurbansociety.com", "conrad.de", "rugs.com", "tilebar.com", "4wdsupacentre.com.au", "czechbeadsexclusive.com", "wolfandbadger.com", "sated.com", "dresslily.com", "brightechshop.com", "tennis-point.com", "smiggle.co.uk", "onceuponatee.net", "thursdayboots.com", "lemonde.fr", "gearbest.com", "aerotelegraph.com", "amnesty.de", "radioshack.com", "uniqlo.com", "shopimpressions.com", "ringtoperfection.com", "thejewelhut.co.uk", "brooktaverner.co.uk", "sueddeutsche.de", "opticsplanet.com", "therealreal.com", "shopplanetblue.com", "hotsauce.com", "stanley-pmi.com", "sportsmansguide.com", "planetcyclery.com", "liligal.com", "toolur.com", "golfavenue.com", "nierle.com", "mackage.com", "lovecrafts.com", "blackboxmycar.com", "floryday.com", "papayaclothing.com", "rains.com", "wowcher.co.uk", "okayamadenim.com", "vickypick.com", "bild.de", "intotheam.com", "laptopoutlet.co.uk", "extinctionrebellion.de", "linenchest.com", "urbandecay.co.uk", "forever21.com", "hygoshop.com", "universitycoop.com", "secretsales.com", "petcube.com", "stylewe.com", "lexpro.de", "paperwishes.com", "shoeaholics.com", "harveynorman.ie", "fluevog.com", "dekanta.com", "decalgirl.com", "wethepeopleholsters.com", "wetseal.com", "touratech-usa.com", "chicsoul.com", "sunglasses-shop.co.uk", "topcoat.store", "mightydeals.com", "skatedeluxe.com", "oracle.com", "modes.com", "fathersonsclothing.com", "alaindupetit.eu", "cokodive.com", "yarn.com", "chicwish.com", "dunelondon.com", "freeshipdeal.com", "jskis.com", "theconversation.com", "impressionsvanity.com", "vzbv.de", "flatpyramid.com", "citysightsny.com", "iheartraves.com", "catch.com.au", "emmacloth.com", "mandp.co.uk", "chainedandable.com", "urban-planet.com", "treds.co.uk", "yesstyle.com", "vapoureyes.com.au", "fashionnova.com", "puffy.com", "bettystoybox.com", "zando.co.za", "voylla.com", "gazetadopovo.com.br", "beckettsimonon.com", "greenfingers.com", "sammydress.com", "ttdeye.com", "staud.clothing", "theinsolestore.com", "wickedcushions.com", "museumreplicas.com", "suzyshier.com", "foxnews.com", "spartoo.co.uk", "brandhousedirect.com.au", "brandsego.com", "doreenbeads.com", "diyelectricskateboard.com", "styletread.com.au", "thechivery.com", "mammut.com", "turntablelab.com", "ylighting.com", "ikigaisoul.com", "perigold.com", "o2online.de", "beautytap.com", "motorcyclecloseouts.com", "officesupply.com", "1800flowers.com", "koala.com", "nbcnews.com", "platzl.de", "theater-bielefeld.de", "motoloot.com", "totemokawaiishop.com", "minicasettetomp3.com", "swfa.com", "lighting-direct.co.uk", "justfab.com", "stio.com", "zoolaa.com", "onnit.com", "tentworld.com.au", "shophq.com", "jaanuu.com", "maccosmetics.co.uk", "temptationgifts.com", "unmannedtechshop.co.uk"]
# targets = ["nytimes.com"]

for target in targets:
    target = target.replace('https://', '')
    target = target.replace('http://', '')
    dom = validate_domain(target)
    try:
        service = Service.objects.get(url=dom)
    except ObjectDoesNotExist:
        print("Not found: %s (coerced to %s)" % (target, dom))
        continue

    # We have a match
    for mail in service.mails():
        assert mail.identity.count() == 1

        addr = mail.identity.all()[0].mail.replace('@', '_')  # Make the email compatible with Unix filenames
        date = mail.date_time.strftime('%FT%T').replace(':','_')  # Make the date and time compatible

        # Create folder structure
        dirname = '/tmp/export/%s/%s/' % (target, addr)
        os.makedirs(os.path.dirname(dirname), exist_ok=True)

        # Write to file
        # with open(dirname + '%s.eml' % date, 'w') as fo:
        #     if mail.raw is not None:
        #         fo.write(mail.raw)
        #     else:
        #         print("Mail for addr %s (target=%s) could not be written as it is empty" % (addr, target))
        with open(dirname + '%s.html' % date, 'w') as fo:
            if mail.body_html is not None:
                fo.write(mail.body_html)
            elif mail.body_plain is not None:
                fo.write(mail.body_plain)
            else:
                print("Mail for addr %s (target=%s) could not be written as it is empty" % (addr, target))
